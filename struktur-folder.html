<!doctype html>
<html lang="id">
<head>
<link rel="icon" href="fstructure.png" type="image/x-icon">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Folder Tree → .BAT Maker</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#94a3b8;
    --accent:#38bdf8;
    --glass: rgba(255,255,255,0.03);
    --white:#e6eef8;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:linear-gradient(135deg,#071025 0%,#071730 60%);color:var(--white);padding:18px;box-sizing:border-box;}
  .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:18px;}
  header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:18px;margin:0;}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .card{background:linear-gradient(180deg,var(--card),#071324);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
  .left .controls{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
  button, .file-btn{background:var(--accent);color:#04202b;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .file-btn{display:inline-flex;align-items:center;gap:8px}
  input[type=file]{display:none}
  textarea{width:100%;min-height:320px;resize:vertical;background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:8px;color:var(--white);font-family:ui-monospace,Menlo,monospace;font-size:13px}
  .row{display:flex;gap:8px;align-items:center}
  .muted{color:var(--muted);font-size:13px}
  .right{height:100%}
  .preview{overflow:auto;max-height:520px;padding:8px;background:#06121a;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
  .tree{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;font-size:14px;line-height:1.5}
  .tree ul{list-style:none;margin:0;padding-left:18px}
  .tree li{margin:2px 0;padding:2px 6px;border-radius:6px}
  .tree li.node{display:flex;align-items:center;gap:8px}
  .mini{font-size:12px;color:var(--muted)}
  .actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  .gray-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--white);padding:8px 10px;border-radius:8px;cursor:pointer}
  footer{grid-column:1/-1;margin-top:8px;color:var(--muted);font-size:13px;text-align:right}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr;padding-bottom:30px}
    .right{order:2}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Folder Tree → .BAT Maker</h1>
        <p class="lead">Unggah file teks atau ketik langsung. Indentasi menentukan hirarki.</p>
      </div>
      <div class="mini">Hasil: <span id="countFolders">0</span> folder</div>
    </header>

    <section class="card left">
      <div class="controls">
        <label class="file-btn">
          Pilih file .txt
          <input id="fileInput" type="file" accept=".txt,text/plain">
        </label>
        <button id="parseBtn" class="gray-btn">Parse</button>
        <button id="clearBtn" class="gray-btn">Bersihkan</button>
        <div style="flex:1"></div>
        <div class="mini muted">Indent unit terdeteksi otomatis.</div>
      </div>

      <textarea id="textInput" placeholder="Tempel teks di sini"></textarea>

      <div class="actions">
        <button id="showTreeBtn" class="gray-btn">Tampilkan Tree</button>
        <button id="downloadBtn" class="file-btn" style="display:none">Download .bat</button>
        <button id="copyBtn" class="gray-btn" style="display:none">Copy .bat ke clipboard</button>
        <div style="flex:1"></div>
        <label class="mini muted" title="Opsional">Nama file .bat:
          <input id="batName" type="text" value="create-folders.bat" style="margin-left:8px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--white)">
        </label>
      </div>
    </section>

    <aside class="card right">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div><strong>Preview tree</strong><div class="mini muted">Urutan sesuai input</div></div>
        <div class="mini muted">Double-click .bat untuk jalankan</div>
      </div>
      <div class="preview">
        <div id="treeContainer" class="tree">Belum ada data — unggah atau paste teks lalu tekan Parse.</div>
        <pre id="batPreview" style="white-space:pre-wrap;margin-top:12px;display:none;background:transparent;color:var(--muted);font-size:13px"></pre>
      </div>
    </aside>

    <footer class="muted">Karakter ilegal (< > : " / \ | ? *) dihapus otomatis.</footer>
  </div>

<script>
(() => {
  const fileInput = document.getElementById('fileInput');
  const parseBtn = document.getElementById('parseBtn');
  const textInput = document.getElementById('textInput');
  const treeContainer = document.getElementById('treeContainer');
  const showTreeBtn = document.getElementById('showTreeBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const copyBtn = document.getElementById('copyBtn');
  const batPreview = document.getElementById('batPreview');
  const countFolders = document.getElementById('countFolders');
  const batNameInput = document.getElementById('batName');
  const clearBtn = document.getElementById('clearBtn');

  fileInput.addEventListener('change', handleFile, false);
  parseBtn.addEventListener('click', parseAndRender, false);
  showTreeBtn.addEventListener('click', parseAndRender, false);
  downloadBtn.addEventListener('click', downloadBat, false);
  copyBtn.addEventListener('click', copyBatToClipboard, false);
  clearBtn.addEventListener('click', () => {
    textInput.value = '';
    treeContainer.innerHTML = 'Belum ada data — unggah atau paste teks lalu tekan Parse.';
    batPreview.style.display = 'none';
    downloadBtn.style.display = 'none';
    copyBtn.style.display = 'none';
    countFolders.textContent = '0';
  });

  function handleFile(e){
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = evt => textInput.value = String(evt.target.result).replace(/\r\n/g,'\n');
    reader.readAsText(f);
  }

  function parseAndRender(){
    const raw = textInput.value.replace(/\r\n/g,'\n');
    const lines = raw.split('\n');
    const parsed = parseIndentedLines(lines);
    renderTree(parsed.nodes);
    const bat = makeBatContent(parsed.paths);
    batPreview.textContent = bat;
    batPreview.style.display = 'block';
    downloadBtn.style.display = parsed.paths.length ? 'inline-flex' : 'none';
    copyBtn.style.display = parsed.paths.length ? 'inline-flex' : 'none';
    countFolders.textContent = parsed.paths.length;
    downloadBtn._content = bat;
    downloadBtn._filename = batNameInput.value || 'create-folders.bat';
  }

  function parseIndentedLines(lines){
    const wsCounts = [];
    for(const raw of lines){
      const t = raw.replace(/\t/g,'    ');
      if(!t.trim()) continue;
      if(t.trim() === '--') continue;
      const match = t.match(/^(\s*)\S/);
      if(match && match[1].length > 0) wsCounts.push(match[1].length);
    }
    const unit = wsCounts.length ? Math.min(...wsCounts) : 1;
    const root = {name:'ROOT',children:[]};
    let lastParents = {0: root};

    for(const rawLine of lines){
      let line = rawLine.replace(/\t/g, '    ');
      if(!line.trim() || line.trim() === '--') continue;
      const m = line.match(/^(\s*)/);
      const lead = m ? m[1].length : 0;
      const depth = unit > 0 ? Math.round(lead / unit) : 0;
      const name = sanitizeName(line.trim());
      if(!name) continue;
      const node = {name, children:[]};
      const parentNode = lastParents[depth] || root;
      parentNode.children.push(node);
      lastParents[depth+1] = node;
      Object.keys(lastParents).forEach(k => {
        if(Number(k) > depth+1) delete lastParents[k];
      });
    }

    const orderedPaths = [];
    function walk(node, prefix){
      for(const child of node.children){
        const parts = prefix.concat([child.name]);
        orderedPaths.push(parts.join('\\'));
        if(child.children.length) walk(child, parts);
      }
    }
    walk(root, []);
    return {paths: orderedPaths, nodes: root.children};
  }

  function sanitizeName(name){
    name = name.replace(/[\x00-\x1F]/g, '');
    name = name.replace(/[<>:"\/\\|?*]/g, '');
    name = name.trim().replace(/[.\s]+$/g, '');
    return name;
  }

  function renderTree(nodes){
    if(!nodes || !nodes.length){
      treeContainer.innerHTML = '<div class="mini muted">Tidak ada folder terdeteksi.</div>';
      return;
    }
    treeContainer.innerHTML = '';
    treeContainer.appendChild(buildList(nodes));
  }

  function buildList(nodes){
    const ul = document.createElement('ul');
    for(const n of nodes){
      const li = document.createElement('li');
      const row = document.createElement('div');
      row.className = 'node';
      const nameSpan = document.createElement('span');
      nameSpan.textContent = n.name;
      nameSpan.style.fontWeight = '600';
      const count = document.createElement('span');
      count.className = 'mini';
      if(n.children.length) count.textContent = `(${n.children.length})`;
      row.appendChild(nameSpan);
      row.appendChild(count);
      li.appendChild(row);
      if(n.children.length) li.appendChild(buildList(n.children));
      ul.appendChild(li);
    }
    return ul;
  }

  function makeBatContent(pathsArray){
    const seen = new Set();
    const paths = [];
    for(const p of pathsArray){
      if(!p) continue;
      if(seen.has(p)) continue;
      seen.add(p);
      paths.push(p);
    }
    const lines = [];
    lines.push('@echo off');
    lines.push(':: Generated by Folder Tree → .BAT Maker');
    lines.push('');
    for(const p of paths) lines.push('md "' + p + '"');
    lines.push('');
    lines.push('echo.');
    lines.push('echo Done. Created ' + paths.length + ' folder(s).');
    lines.push('pause');
    return lines.join('\r\n'); // ✅ fix: gunakan newline asli
  }

  function downloadBat(){
    const content = downloadBtn._content || '';
    const filename = (downloadBtn._filename || 'create-folders.bat').replace(/[\\\/:*?"<>|]/g,'_');
    const blob = new Blob([content], {type: 'application/octet-stream'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 5000);
  }

  async function copyBatToClipboard(){
    try{
      await navigator.clipboard.writeText(downloadBtn._content || '');
      copyBtn.textContent = 'Copied ✓';
      setTimeout(()=> copyBtn.textContent = 'Copy .bat ke clipboard', 1200);
    }catch(e){
      alert('Gagal copy: ' + (e?.message||e));
    }
  }

  textInput.addEventListener('keydown', (e) => {
    if(e.ctrlKey && e.key === 'Enter') parseAndRender();
  });

})();
</script>
</body>
</html>
